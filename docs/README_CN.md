# æ™ºèƒ½èƒ¶å›Šåˆ†é…å™¨ (Smart Capsule Dispenser)

[![FranÃ§ais](https://img.shields.io/badge/Language-FranÃ§ais-blue.svg)](../README.md)

**å¹³å°:** Raspberry Pi 5 (Bookworm OS) | **çŠ¶æ€:** ç¨³å®š (S5) | **æœ€åæ›´æ–°:** 2025-12

è¿™æ˜¯ä¸€ä¸ªå®‰å…¨çš„ã€æ”¯æŒç”Ÿç‰©è¯†åˆ«çš„èƒ¶å›Šåˆ†é…ç³»ç»Ÿã€‚å®ƒå°†æ ‡å‡†çš„èƒ¶å›Šå±•ç¤ºæ¶è½¬å˜ä¸ºä¸ªæ€§åŒ–çš„â€œä¿¡ç®±â€ç³»ç»Ÿï¼Œæ¯ä¸ªç”¨æˆ·é€šè¿‡æŒ‡çº¹æˆ–äººè„¸è®¤è¯æ‹¥æœ‰å¯¹ç‰¹å®šå­˜å‚¨é€šé“çš„ä¸“å±è®¿é—®æƒã€‚ç³»ç»Ÿæ”¯æŒå¤šç”¨æˆ·å½•å…¥ã€æƒé™åˆ†çº§ï¼ˆç®¡ç†å‘˜/æ™®é€šç”¨æˆ·ï¼‰ä»¥åŠç‰©ç†é€šé“çš„åŠ¨æ€åˆ†é…ã€‚

---

## âœ¨ ä¸»è¦åŠŸèƒ½

*   **å¤šçº¿ç¨‹æ¶æ„**: äººè„¸è¯†åˆ«åœ¨åå°çº¿ç¨‹è¿è¡Œï¼Œä¸»çº¿ç¨‹è´Ÿè´£ UI åˆ·æ–°ï¼Œç¡®ä¿å€’è®¡æ—¶**å¹³æ»‘çº¿æ€§**ï¼Œæ— å¡é¡¿ã€‚
*   **æ™ºèƒ½ç”µæºä¸ä¼šè¯ç®¡ç†**: 
    *   30ç§’æ— æ“ä½œè‡ªåŠ¨ä¼‘çœ ã€‚
    *   ç‰©ç†æŒ‰é’®æ”¯æŒ**å”¤é†’åŠç»­å‘½**åŠŸèƒ½ï¼ˆå¢åŠ  30sï¼‰ã€‚
    *   å®‰å…¨ä¿æŠ¤ï¼šè®¾ç½® 5 åˆ†é’Ÿå¼ºåˆ¶ä¼‘çœ ä¸Šé™ã€‚
*   **å®æ—¶äº¤äº’ç•Œé¢**: 1.3" IPS å±å¹•å®æ—¶æ˜¾ç¤ºæ—¶é—´ã€çŠ¶æ€åŠ**ç§’çº§å€’è®¡æ—¶**ã€‚å€’è®¡æ—¶å°‘äº 10s æ—¶è‡ªåŠ¨å˜çº¢æé†’ã€‚
*   **å¤šç”¨æˆ·è§’è‰²ç®¡ç†**: æ”¯æŒ 1 ä¸ªè¶…çº§ç®¡ç†å‘˜å’Œæ— é™å€™è¡¥ç”¨æˆ·ã€‚ç‰©ç†é€šé“ï¼ˆèˆµæœºï¼‰ä»…åˆ†é…ç»™æ´»è·ƒç”¨æˆ·ï¼ˆæœ€å¤š 5 äººï¼‰ã€‚

---

## ğŸ›  ç¡¬ä»¶æ¶æ„

*   **æ§åˆ¶å™¨**: Raspberry Pi 5 (æ¨è 8GB)ã€‚
*   **æ‰§è¡Œå™¨**: 5x SG90 å¾®å‹èˆµæœº (9g)ã€‚
*   **ä¼ æ„Ÿå™¨**: DY-50 / R307 å…‰å­¦æŒ‡çº¹æ¨¡å— (UART) + Camera Module 3 (IMX708)ã€‚
*   **äººæœºäº¤äº’**: 1.3" IPS LCD (ST7789) + **å”¤é†’æŒ‰é’® (Wake-Up Button)**ã€‚
*   **ä¾›ç”µ**: èˆµæœºå¿…é¡»ä½¿ç”¨ **å¤–éƒ¨ 5V ç”µæº** (å¿…é¡»ä¸ Pi å…±åœ°)ã€‚

> **âš ï¸ æ¥çº¿è­¦å‘Š**: ä¸è¦ç›´æ¥ä» Pi çš„ GPIO 5V å¼•è„šä¸º 5 ä¸ªèˆµæœºä¾›ç”µã€‚è¯·ä½¿ç”¨å¤–éƒ¨ç”µæºã€‚è¯¦è§ [WIRING_GUIDE.md](WIRING_GUIDE.md)ã€‚

---

## ğŸš€ å®‰è£…ä¸è®¾ç½®

### 1. ç³»ç»Ÿä¾èµ–
```bash
sudo apt-get update
sudo apt-get install python3-serial python3-pip python3-lgpio python3-pil python3-rpi.gpio
```

### 2. Python åº“
```bash
sudo pip3 install adafruit-circuitpython-fingerprint st7789
```

### 3. äººè„¸è¯†åˆ«ç¯å¢ƒ (Pi 5 Bookworm)

**å‰ææ¡ä»¶: å®‰è£… GStreamer æ’ä»¶ (Pi 5 å¿…é¡»)**
```bash
sudo apt install libgstreamer1.0-dev libgstreamer-plugins-base1.0-dev \
    gstreamer1.0-plugins-base gstreamer1.0-plugins-good gstreamer1.0-plugins-bad \
    gstreamer1.0-libcamera gstreamer1.0-tools
```

**å®‰è£… OpenCV ä¸ Face Recognition**
```bash
sudo apt update
sudo apt install python3-opencv python3-face-recognition
```

### 4. ç½‘ç»œé…ç½® (ç¦»çº¿çƒ­ç‚¹)
ä¸ºäº†è®©æ‰‹æœº App èƒ½åœ¨æ²¡æœ‰å¤–ç½‘çš„æƒ…å†µä¸‹æ§åˆ¶ Piï¼ŒåŒæ—¶ä¿æŒæ‰‹æœºè‡ªèº«çš„ 4G/5G ä¸Šç½‘ï¼Œè¯·é…ç½®â€œæ— ç½‘å…³â€çƒ­ç‚¹æ¨¡å¼ï¼š

**å¼€å¯çƒ­ç‚¹:**
```bash
sudo ./tools/setup_manual_hotspot.sh
```
*   è¿™å°†åˆ›å»º Wi-Fi `DistCapsule_Box` (IP: 192.168.4.1)ã€‚æ‰‹æœºè¿æ¥åä¼šè‡ªåŠ¨ä¿æŒ 4G ä¸Šç½‘ã€‚

**å…³é—­çƒ­ç‚¹ (æ¢å¤æ­£å¸¸ Wi-Fi):**
```bash
sudo ./tools/stop_hotspot.sh
```

---

## ğŸ“– ä½¿ç”¨æŒ‡å—

### 1. åˆå§‹åŒ–ç³»ç»Ÿ
åˆ›å»ºæ•°æ®åº“è¡¨åŠåˆå§‹åŒ–é…ç½®ã€‚
```bash
python3 tools/setup_database.py
```

### 2. ç®¡ç†æŒ‡çº¹ç”¨æˆ·
å¯åŠ¨æŒ‡çº¹ç®¡ç†å·¥å…·ï¼Œå½•å…¥ç®¡ç†å‘˜æˆ–åˆ†é…èˆµæœºé€šé“ã€‚
```bash
sudo python3 tools/fingerprint_enroll.py
```

### 3. å½•å…¥äººè„¸
ä¸ºç°æœ‰ç”¨æˆ·å½•å…¥äººè„¸æ•°æ®ï¼ˆæ”¯æŒ SSH æ— å¤´æ¨¡å¼è‡ªåŠ¨å½•å…¥ï¼‰ï¼š
```bash
python3 tools/face_enroll.py
```

### 4. ç¡¬ä»¶æµ‹è¯•
éªŒè¯æ‰€æœ‰ç»„ä»¶ï¼ˆèˆµæœºã€å±å¹•ã€æŒ‡çº¹ã€ç›¸æœºï¼‰æ˜¯å¦å·¥ä½œæ­£å¸¸ã€‚
```bash
sudo python3 tools/hardware_test.py
```

### 5. è¿è¡Œä¸»ç¨‹åº
å¯åŠ¨ç³»ç»Ÿã€‚ç³»ç»Ÿé»˜è®¤è¿›å…¥ **ä¼‘çœ æ¨¡å¼ (Sleep Mode)**ï¼ˆå±å¹•å…³é—­ï¼‰ä»¥èŠ‚çœèƒ½æºã€‚
*   **å”¤é†’**: æŒ‰ä¸‹ **ç‰©ç†å”¤é†’æŒ‰é’®**ã€‚
*   **è‡ªåŠ¨ä¼‘çœ **: æ— æ“ä½œ 30 ç§’åè‡ªåŠ¨é‡æ–°è¿›å…¥ä¼‘çœ ã€‚

```bash
sudo python3 main.py
```

### 6. è®¾ç½®å¼€æœºè‡ªå¯
```bash
./tools/install_service.sh
```

---

## ğŸ“‚ é¡¹ç›®ç»“æ„

| æ–‡ä»¶/ç›®å½• | æè¿° |
| :--- | :--- |
| `main.py` | **æ ¸å¿ƒåº”ç”¨**. å¤„ç†è®¤è¯å¾ªç¯ã€UI æ›´æ–°å’Œä¸šåŠ¡é€»è¾‘ã€‚ |
| `hardware/` | **ç¡¬ä»¶é©±åŠ¨**. åŒ…å«èˆµæœºã€å±å¹•ã€äººè„¸è¯†åˆ«ç³»ç»Ÿç­‰å°è£…ç±»ã€‚ |
| `tools/` | **å·¥å…·è„šæœ¬**. åŒ…å«å®‰è£…ã€æµ‹è¯•ã€å½•å…¥ç­‰è¾…åŠ©è„šæœ¬ã€‚ |
| `docs/` | **æ–‡æ¡£**. æ¥çº¿æŒ‡å—ã€ä¸­æ–‡è¯´æ˜åŠå½’æ¡£æ–‡æ¡£ã€‚ |
| `capsule_dispenser.db` | **æ•°æ®åº“**. å­˜å‚¨ç”¨æˆ·ä¿¡æ¯ã€æŒ‡çº¹ ID åŠäººè„¸ç‰¹å¾ã€‚ |

---

## ğŸ“œ å†å²ä¸å†³ç­–

*   **2025-12 (S5)**: 
    *   **å¤šçº¿ç¨‹é‡æ„**: å¼•å…¥ Python `threading` å’Œ `queue` æ¨¡å—ï¼Œå°† AI è¯†åˆ«ä¸ UI åˆ·æ–°åˆ†ç¦»ï¼Œæå¤§æå‡äº¤äº’æµç•…åº¦ã€‚
    *   **å…¨é‡ lgpio è¿ç§»**: ç§»é™¤ `RPi.GPIO`ï¼Œæ‰€æœ‰ GPIO æ“ä½œï¼ˆèˆµæœºã€æŒ‰é’®ï¼‰ç»Ÿä¸€ä½¿ç”¨ `lgpio`ï¼Œè§£å†³ Pi 5 ç¡¬ä»¶å†²çªã€‚
    *   **UI ä½“éªŒå‡çº§**: å¢åŠ ç§’çº§åŠ¨æ€å€’è®¡æ—¶å’Œé¢œè‰²é¢„è­¦ã€‚
    *   **æƒé™ä¸åˆ†é…**: å®ç°ç”¨æˆ·è§’è‰²åˆ†çº§åŠç‰©ç†é€šé“çš„åŠ¨æ€ç»‘å®šã€‚

---## License
MIT License